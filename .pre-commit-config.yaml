# Pre-commit hooks for OpenAI Responses Gateway
# Install: pre-commit install
# Run manually: pre-commit run --all-files

repos:
  # Go code formatting and linting
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: trailing-whitespace
      - id: end-of-file-fixer
      - id: check-yaml
        args: [--unsafe]  # Allow custom YAML tags
      - id: check-added-large-files
        args: [--maxkb=1000]
      - id: check-merge-conflict
      - id: check-case-conflict
      - id: mixed-line-ending

  # Go formatting
  - repo: https://github.com/dnephin/pre-commit-golang
    rev: v0.5.1
    hooks:
      - id: go-fmt
      - id: go-mod-tidy
      # Note: Run 'make lint' manually for full linting with golangci-lint
      # Note: go-imports requires Go bin in PATH - run manually if needed

  # Local validation hooks
  - repo: local
    hooks:
      # Generate and verify OpenAPI spec from Go annotations
      - id: gen-openapi
        name: Check generated OpenAPI spec is up to date
        entry: bash -c 'make gen-openapi && git diff --exit-code docs/swagger.yaml'
        language: system
        pass_filenames: false
        files: ^(cmd/server/main\.go|pkg/adapters/http/.*\.go|pkg/core/schema/.*\.go)$

      # Check OpenAPI conformance against OpenAI spec
      - id: openapi-conformance
        name: Check OpenAPI conformance with OpenAI spec
        entry: bash -c 'echo "Checking OpenAPI conformance..." && uv run --with pyyaml scripts/conformance/openapi_conformance.py 2>&1 | tail -20 || echo "Conformance check failed - run '\''make test-openapi-conformance'\'' for details"'
        language: system
        pass_filenames: false
        files: ^docs/swagger\.yaml$
        verbose: true
        # Note: Hook will run when openapi.yaml changes but won't block commits (|| echo)
        # To force run: pre-commit run openapi-conformance --all-files
        # For full report: make test-openapi-conformance

      # Note: Full conformance tests (Open Responses) can be run manually with: make test-conformance
      # They are skipped in pre-commit to keep commits fast
