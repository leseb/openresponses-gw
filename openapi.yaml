openapi: 3.0.0
info:
  title: OpenAI Responses Gateway API
  description: |
    **100% Open Responses Specification Compliant Gateway**

    Based on: https://github.com/openresponses/openresponses

    This gateway provides:
    - **Core API**: Full Open Responses spec compliance (POST /v1/responses)
    - **Extended APIs**: Conversations, Prompts, Files, Vector Stores, Models
    - **Dual Mode**: Standalone HTTP server or Envoy ExtProc integration

    Streaming: All 24 event types from Open Responses spec
    Request Echo: All request parameters returned in response
    Multimodal: Support for text, images, files, video

  version: 1.0.0
  contact:
    name: OpenAI Responses Gateway
    url: https://github.com/leseb/openai-responses-gateway

servers:
  - url: http://localhost:8080
    description: Local development server

tags:
  - name: Health
    description: Health check and API documentation
  - name: Responses
    description: Open Responses API (100% spec compliant)
  - name: Conversations
    description: Extended - Conversation state management
  - name: Prompts
    description: Extended - Prompt template management
  - name: Files
    description: Extended - File upload and management
  - name: Vector Stores
    description: Extended - Vector store and embeddings
  - name: Models
    description: Extended - Model discovery

paths:
  /health:
    get:
      tags: [Health]
      summary: Health check
      operationId: getHealth
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: healthy

  /openapi.json:
    get:
      tags: [Health]
      summary: Get OpenAPI specification (JSON)
      operationId: getOpenAPISpec
      responses:
        '200':
          description: OpenAPI specification
          content:
            application/json:
              schema:
                type: object

  /v1/responses:
    post:
      tags: [Responses]
      summary: Create response
      description: |
        **Open Responses API - 100% Spec Compliant**

        Create a response with streaming or non-streaming output.
        All request parameters are echoed back in the response.

        Streaming: Set `stream: true` (HTTP-specific, not in spec)
        Returns 24 granular event types via Server-Sent Events

        Supports:
        - Multi-turn conversations (previous_response_id)
        - Tool/function calling (tools, tool_choice)
        - Reasoning models (reasoning config for o1/o3)
        - Multimodal input (text, images, files, video)

      operationId: createResponse
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResponseRequest'
            examples:
              simple:
                summary: Simple text request
                value:
                  model: gpt-4
                  input: "What is 2+2?"
              with_instructions:
                summary: With system instructions
                value:
                  model: gpt-4
                  input: "Explain quantum computing"
                  instructions: "You are a physics professor. Be concise."
              streaming:
                summary: Streaming request
                value:
                  model: gpt-4
                  input: "Tell me a story"
                  stream: true
              multi_turn:
                summary: Follow-up conversation
                value:
                  model: gpt-4
                  input: "Tell me more"
                  previous_response_id: "resp_abc123"
      responses:
        '200':
          description: Response created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Response'
            text/event-stream:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/ResponseCreatedEvent'
                  - $ref: '#/components/schemas/ResponseInProgressEvent'
                  - $ref: '#/components/schemas/ResponseCompletedEvent'
                  - $ref: '#/components/schemas/ResponseOutputTextDeltaEvent'
                  - $ref: '#/components/schemas/ErrorEvent'

  # Extended APIs (not in Open Responses spec)

  /v1/conversations:
    post:
      tags: [Conversations]
      summary: Create conversation
      operationId: createConversation
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateConversationRequest'
      responses:
        '200':
          description: Conversation created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Conversation'
    get:
      tags: [Conversations]
      summary: List conversations
      operationId: listConversations
      parameters:
        - $ref: '#/components/parameters/Limit'
        - $ref: '#/components/parameters/Order'
      responses:
        '200':
          description: List of conversations

  /v1/prompts:
    post:
      tags: [Prompts]
      summary: Create prompt template
      operationId: createPrompt
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreatePromptRequest'
      responses:
        '200':
          description: Prompt created
    get:
      tags: [Prompts]
      summary: List prompts
      operationId: listPrompts
      responses:
        '200':
          description: List of prompts

  /v1/files:
    post:
      tags: [Files]
      summary: Upload file
      operationId: uploadFile
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file, purpose]
              properties:
                file:
                  type: string
                  format: binary
                purpose:
                  type: string
                  enum: [assistants, vision, batch, fine-tune]
      responses:
        '200':
          description: File uploaded
    get:
      tags: [Files]
      summary: List files
      operationId: listFiles
      responses:
        '200':
          description: List of files

  /v1/vector_stores:
    post:
      tags: [Vector Stores]
      summary: Create vector store
      operationId: createVectorStore
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateVectorStoreRequest'
      responses:
        '200':
          description: Vector store created
    get:
      tags: [Vector Stores]
      summary: List vector stores
      operationId: listVectorStores
      responses:
        '200':
          description: List of vector stores

  /v1/models:
    get:
      tags: [Models]
      summary: List available models
      operationId: listModels
      responses:
        '200':
          description: List of models
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListModelsResponse'

components:
  parameters:
    Limit:
      name: limit
      in: query
      description: Number of items (1-100, default 50)
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 50

    Order:
      name: order
      in: query
      description: Sort order
      schema:
        type: string
        enum: [asc, desc]
        default: desc

  schemas:
    # Core Open Responses Schemas

    ResponseRequest:
      type: object
      description: Request to create a response (Open Responses spec compliant)
      properties:
        model:
          type: string
          nullable: true
          description: Model ID (e.g., gpt-4, claude-3-opus)
          example: gpt-4
        input:
          description: String or array of input items
          oneOf:
            - type: string
              maxLength: 10485760
            - type: array
              items:
                $ref: '#/components/schemas/InputItem'
        previous_response_id:
          type: string
          nullable: true
          description: ID of previous response for multi-turn
          example: resp_abc123
        include:
          type: array
          items:
            type: string
          description: What to include in response
        tools:
          type: array
          items:
            $ref: '#/components/schemas/Tool'
          description: Tools available to the model
        tool_choice:
          description: Control which tool to use
          oneOf:
            - type: string
              enum: [none, auto, required]
            - type: object
        reasoning:
          $ref: '#/components/schemas/ReasoningConfig'
        instructions:
          type: string
          nullable: true
          description: System message / instructions
        temperature:
          type: number
          format: float
          nullable: true
          minimum: 0
          maximum: 2
        top_p:
          type: number
          format: float
          nullable: true
        max_output_tokens:
          type: integer
          nullable: true
        max_tool_calls:
          type: integer
          nullable: true
        parallel_tool_calls:
          type: boolean
          nullable: true
        store:
          type: boolean
          nullable: true
          description: Whether to store conversation
        frequency_penalty:
          type: number
          format: float
          nullable: true
          minimum: -2
          maximum: 2
        presence_penalty:
          type: number
          format: float
          nullable: true
          minimum: -2
          maximum: 2
        truncation:
          $ref: '#/components/schemas/TruncationStrategy'
        top_logprobs:
          type: integer
          nullable: true
        service_tier:
          type: string
          nullable: true
        background:
          type: boolean
          nullable: true
        prompt_cache_key:
          type: string
          nullable: true
        safety_identifier:
          type: string
          nullable: true
        metadata:
          type: object
          additionalProperties:
            type: string
        stream:
          type: boolean
          description: HTTP-specific - enable SSE streaming
          default: false

    Response:
      type: object
      description: Response object (Open Responses spec compliant)
      required: [id, object, created_at, model, status]
      properties:
        id:
          type: string
          example: resp_abc123
        object:
          type: string
          example: response
        created_at:
          type: integer
          format: int64
          description: Unix timestamp
        completed_at:
          type: integer
          format: int64
          nullable: true
        model:
          type: string
          example: gpt-4
        status:
          type: string
          enum: [queued, in_progress, completed, failed, incomplete]
        output:
          type: array
          items:
            $ref: '#/components/schemas/OutputItem'
        usage:
          $ref: '#/components/schemas/Usage'
        error:
          $ref: '#/components/schemas/ErrorDetails'
        incomplete_details:
          $ref: '#/components/schemas/IncompleteDetails'
        metadata:
          type: object
          additionalProperties:
            type: string
        # Echo all request parameters
        previous_response_id:
          type: string
          nullable: true
        instructions:
          type: string
          nullable: true
        tools:
          type: array
          items:
            $ref: '#/components/schemas/Tool'
        tool_choice:
          nullable: true
        reasoning:
          $ref: '#/components/schemas/ReasoningConfig'
        temperature:
          type: number
          nullable: true
        top_p:
          type: number
          nullable: true
        max_output_tokens:
          type: integer
          nullable: true
        max_tool_calls:
          type: integer
          nullable: true
        parallel_tool_calls:
          type: boolean
          nullable: true
        store:
          type: boolean
          nullable: true
        frequency_penalty:
          type: number
          nullable: true
        presence_penalty:
          type: number
          nullable: true
        truncation:
          $ref: '#/components/schemas/TruncationStrategy'
        top_logprobs:
          type: integer
          nullable: true
        service_tier:
          type: string
          nullable: true
        background:
          type: boolean
          nullable: true
        prompt_cache_key:
          type: string
          nullable: true
        safety_identifier:
          type: string
          nullable: true
        text:
          type: string
          nullable: true
          description: Convenience field - concatenated output text

    InputItem:
      type: object
      description: Input item (message, file, etc.)
      properties:
        type:
          type: string
          enum: [message, file, image, video, item_reference]
        role:
          type: string
          enum: [user, assistant, system, developer]
        content:
          type: string

    OutputItem:
      type: object
      description: Output item (discriminated by type)
      required: [type]
      properties:
        type:
          type: string
          enum: [message, function_call, function_call_output, reasoning]
        id:
          type: string
        role:
          type: string
          enum: [user, assistant, system, developer]
        content:
          type: array
          items:
            $ref: '#/components/schemas/ContentPart'
        status:
          type: string
          enum: [in_progress, completed]
        name:
          type: string
        call_id:
          type: string
        arguments:
          type: string
        output:
          type: string
        summary:
          type: string

    ContentPart:
      type: object
      description: Content part within a message
      required: [type]
      properties:
        type:
          type: string
          enum: [text, image, file, video, refusal, output_text_annotation]
        text:
          type: string
        image_url:
          type: object
          properties:
            url:
              type: string
            detail:
              type: string
              enum: [auto, low, high]
        file_id:
          type: string
        video_url:
          type: object
          properties:
            url:
              type: string

    Tool:
      type: object
      description: Tool definition
      required: [type]
      properties:
        type:
          type: string
          enum: [function, file_search, web_search]
        function:
          type: object
          properties:
            name:
              type: string
            description:
              type: string
            parameters:
              type: object
              description: JSON Schema
            strict:
              type: boolean

    ReasoningConfig:
      type: object
      description: Reasoning configuration for o1/o3 models
      properties:
        type:
          type: string
          enum: [default, extended]
        effort:
          type: string
          enum: [low, medium, high]
        budget:
          type: object
          properties:
            token_budget:
              type: integer

    TruncationStrategy:
      type: object
      properties:
        type:
          type: string
          enum: [auto, last_messages]
        last_messages:
          type: integer

    Usage:
      type: object
      description: Token usage statistics
      properties:
        input_tokens:
          type: integer
        output_tokens:
          type: integer
        total_tokens:
          type: integer
        input_tokens_details:
          type: object
          properties:
            cached_tokens:
              type: integer
            audio_tokens:
              type: integer
            text_tokens:
              type: integer
            image_tokens:
              type: integer
        output_tokens_details:
          type: object
          properties:
            reasoning_tokens:
              type: integer
            audio_tokens:
              type: integer
            text_tokens:
              type: integer

    ErrorDetails:
      type: object
      properties:
        type:
          type: string
        code:
          type: string
        message:
          type: string
        param:
          type: string

    IncompleteDetails:
      type: object
      properties:
        reason:
          type: string
          enum: [max_output_tokens, content_filter]

    # Streaming Events (24 types)

    ResponseCreatedEvent:
      type: object
      properties:
        type:
          type: string
          example: response.created
        response:
          $ref: '#/components/schemas/Response'

    ResponseInProgressEvent:
      type: object
      properties:
        type:
          type: string
          example: response.in_progress
        response:
          $ref: '#/components/schemas/Response'

    ResponseCompletedEvent:
      type: object
      properties:
        type:
          type: string
          example: response.completed
        response:
          $ref: '#/components/schemas/Response'

    ResponseOutputTextDeltaEvent:
      type: object
      properties:
        type:
          type: string
          example: response.output_text.delta
        response_id:
          type: string
        output_index:
          type: integer
        content_index:
          type: integer
        delta:
          type: string

    ErrorEvent:
      type: object
      properties:
        type:
          type: string
          example: error
        error:
          $ref: '#/components/schemas/ErrorDetails'

    # Extended API Schemas

    Conversation:
      type: object
      properties:
        id:
          type: string
        object:
          type: string
          example: conversation
        created_at:
          type: integer
          format: int64
        metadata:
          type: object

    CreateConversationRequest:
      type: object
      properties:
        metadata:
          type: object

    CreatePromptRequest:
      type: object
      required: [name, template]
      properties:
        name:
          type: string
        description:
          type: string
        template:
          type: string
          example: "Hello {{name}}!"
        metadata:
          type: object

    CreateVectorStoreRequest:
      type: object
      properties:
        name:
          type: string
        file_ids:
          type: array
          items:
            type: string
          maxItems: 500
        metadata:
          type: object

    Model:
      type: object
      properties:
        id:
          type: string
          example: gpt-4
        object:
          type: string
          example: model
        created:
          type: integer
          format: int64
        owned_by:
          type: string

    ListModelsResponse:
      type: object
      properties:
        object:
          type: string
          example: list
        data:
          type: array
          items:
            $ref: '#/components/schemas/Model'
